---
title: "Midterm"
author: "Katie Miller"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
require(broom)
require(ggplot2)
require(plyr)
require(dplyr)
require(dplyr)
require(MASS)
require(car)
require(AER)
require(ggpubr)
require(AICcmodavg)
library(tidyverse)
library(here)
library(NatParksPalettes)
library(lterdatasampler)
```

## Problem 1

a.  Ho = the mean phosphorus content in the burned and unburned sites is not significantly different. Ha = there is a significant difference between mean phosphorus content in the soil of the burned and unburned sites.

b.  t-test to determine if the mean of the two areas is significantly different.

c.  To perform a successful student's t-test, we assume that the data sets are evenly distributed and have an equal variance.

d.  if the data sets had an unequal variance we could perform a Welch's t-test.

e.  Because the p-value is less than 0.05, we can reject the null hypothesis that there is no difference in phosphorus content between the burned and unburned sites. 

f.  Ho = the mean phosphorus content of the soil before and after the fire is not significantly different. 
Ha = the mean phosphorus content of the soil is unchanged before and after the fires. 

g. I would preform a t-test to compare the mean phosphorus content of the soil before and after the fire in each survey site. 

## Problem 2


a. Roads may hinder pollinator movement and limit pollination of plants across and along roads. 
In this study, a fluorescent pigment is used as an analogue for pollen to track the visitation of flowers by pollinators.
A II
Habitat corridors could help pollinators cross roads and bike paths to reach flowers. Promoting alternative methods of transportation and reducing the number of cars on the road could also reduce pollinator deaths by collision and allow for safer road crossings.

b.
```{r}
# reading in data, correct file paths
roadcomp <- read.csv("~/git/ENVS-193DS_midterm_miller_katie/data/roadcomp.csv", skip=1)
sites <- read.csv("~/git/ENVS-193DS_midterm_miller_katie/data/roadsite.csv")
contig <- read.csv("~/git/ENVS-193DS_midterm_miller_katie/data/contig.csv", colClasses = c(Site = "factor", type = "factor"))
veg <- read.csv("~/git/ENVS-193DS_midterm_miller_katie/data/roadveg.csv", skip=1, colClasses = c(mowed = "factor", flowers = "factor", seminatural = "factor", weed = "factor"))
veg$lawn[is.na(veg$lawn)] <- 0
veg$lawn <- as.factor(veg$lawn)
fvisits <- read.csv("~/git/ENVS-193DS_midterm_miller_katie/data/flower visits.csv")
```

```{r}
roadcomp2 <- mutate(roadcomp, prop.pig.c =
                  (c.vert.n.high.pigment + c.vert.n.low.pigment)/c.vert.n.flowers,
                    prop.pig.c.hi = c.vert.n.high.pigment/c.vert.n.flowers, 
                    prop.pig.m = (m.fist.n.pigment.high + m.fist.n.pigment.low)/m.fist.n.flowers,
                  prop.pig.mi = m.fist.inflor.pigment/m.fist.n.inflorescences)
roadsite <- merge(roadcomp2, sites, by = "site")
road.c <- subset(roadsite, prop.pig.c != "NA")
road.m <- subset(roadsite, prop.pig.m != "NA")
```

```{r}
# Creating the graphs a b and c

# calculating mean, standard deviation, and standard error for figure 1a
c.prop.sum <- ddply(subset(road.c, number.of.lanes > 0), .(position), summarize,
                  mean = mean(prop.pig.c),
                  sd = sd(prop.pig.c),
                  se = sd(prop.pig.c)/sqrt(length(position)))

# creating the graph for figure 1a 
f1a <- ggplot(c.prop.sum) + 
  # Plotting underlying data
  geom_point(data = subset(road.c, number.of.lanes > 0), 
             aes(x=position, 
                 y = prop.pig.c, 
                 shape = position,
                 color = position), 
             size = 3, alpha = 0.4, 
             position = position_jitter(width = 0.2)) + 
  # Plotting the mean point
  geom_point(aes(x = position, 
                 y = mean, 
                 color = position, 
                 # changed point size to 5 to better resemble figure 1
                 shape = position), size = 5) + 
  # Creating error bars for mean
  geom_errorbar(aes(ymin = mean-se, 
                    ymax = mean+se, 
                    x = position,
                    color=position), width = 0.1, size = 1) + 
  # Theme and label aesthetics 
  theme_bw() + 
  # Changed y axis text to size 1 to better resemble the figure
  theme(axis.text = element_text(colour = "black",size=rel(1)),
        # removed the "across" and "along" labels from x axis
        axis.text.x = element_blank(),
        legend.position = "none") + 
  labs(x = NULL,
       y = NULL)

# calculating mean, standard deviation, and standard error for figure 1b
c.prop.sum.bike <- ddply(subset(road.c, number.of.lanes == 0.5), .(position), summarize,
                  mean = mean(prop.pig.c),
                  sd = sd(prop.pig.c),
                  se = sd(prop.pig.c)/sqrt(length(position)))

# creating the graph for figure 1b
f1b <- ggplot(c.prop.sum.bike) + 
  # Plotting underlying data
  geom_point(data = subset(road.c, number.of.lanes == 0.5),
             aes(x = position, y = prop.pig.c, shape = position, 
                 color = position), size = 3, alpha = 0.4, 
             position = position_jitter(width = 0.2)) + 
  # Plotting the mean point
  geom_point(aes(x=position, y = mean, color = position,
                 # changed point size to 5 to better resemble figure 1
                 shape = position), size = 5) + 
  # Creating error bars for mean
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se, x = position, 
                    color = position), width = 0.1, size = 1) + 
  # Theme and label aesthetics 
  theme_bw() + 
  # Changed y axis text to size 1 to better resemble the figure
  theme(axis.text = element_text(colour = "black",size=rel(1)),
        # removed the "across" and "along" labels from x axis
        axis.text.x = element_blank(),
        legend.position = "none") + 
  labs(x = NULL,
       y = NULL)


# calculating mean, standard deviation, and standard error for figure 1c
c.prop.sum.path <- ddply(subset(road.c, number.of.lanes == 0),
                         .(position), summarize,
                  mean = mean(prop.pig.c),
                  sd = sd(prop.pig.c),
                  se = sd(prop.pig.c)/sqrt(length(position)))

# creating the graph for figure 1c
f1c <- ggplot(c.prop.sum.path) + 
  # Plotting underlying data
  geom_point(data = subset(road.c, number.of.lanes == 0),
             aes(x=position, y = prop.pig.c, shape = position, 
                 color = position), 
             size = 3, alpha = 0.4, 
             position = position_jitter(width = 0.2)) + 
  # Plotting the mean point
  geom_point(aes(x = position, y = mean,  color = position, 
                 # changed point size to 5 to better resemble figure 1
                 shape = position), size = 5) +
  # Creating error bars for mean
  geom_errorbar(aes(ymin = mean-se, 
                    ymax = mean+se, 
                    x = position, 
                    color = position), width = 0.1, size = 1) + 
  # Theme and label aesthetics 
  theme_bw() + 
  # Changed y axis text to size 1 to better resemble the figure
  theme(axis.text = element_text(colour = "black",size=rel(1)), 
        axis.title = element_text(size=rel(1.4), face = "bold"), 
        plot.title = element_text(size = rel(0.5), face = "bold", 
                                  hjust = 0.5), 
        legend.position = "none") + 
  labs(x = "Position relative\nto pedestrian path", 
       y = NULL)

```

```{r}
# Creating graphs d and e


mi.prop.sum <- ddply(subset(road.m, number.of.lanes > 0.5), .(position), summarize,
                  mean = mean(prop.pig.mi),
                  sd = sd(prop.pig.mi),
                  se = sd(prop.pig.mi)/sqrt(length(position)))

f1d <- ggplot(mi.prop.sum) + 
  geom_point(data = subset(road.m, number.of.lanes > 0), 
             aes(x=position, y = prop.pig.mi, shape = position, 
                 color = position), 
             size = 3, alpha = 0.4, position =  position_jitter(width = 0.2)) +
  geom_point(aes(x=position, y = mean, color=position, shape = position), size = 5) + 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se, x=position, color=position), 
                width = 0.1, size = 1) + 
  theme_bw() + 
  # change size to 1
  theme(axis.text = element_text(colour = "black",size=rel(1)), axis.title = element_text(size=rel(1), face = "bold"), plot.title = element_text(size = rel(2), face = "bold", hjust = 0.5), legend.position = "none") + labs(x="Position relative to road", y= NULL)


mi.prop.sum.bike <- ddply(subset(road.m, number.of.lanes == 0.5), .(position), summarize,
                  mean = mean(prop.pig.mi),
                  sd = sd(prop.pig.mi),
                  se = sd(prop.pig.mi)/sqrt(length(position)))
f1e <- ggplot(mi.prop.sum.bike) + geom_point(data = subset(road.m, number.of.lanes == 0.5), aes(x=position, y = prop.pig.mi, shape = position, color = position), size = 3, alpha = 0.4, position = position_jitter(width = 0.4)) + geom_point(aes(x=position, y = mean, color=position, shape = position), size = 5) + geom_errorbar(aes(ymin=mean-se, ymax=mean+se, x=position, color=position), width = 0.1, size = 1) + theme_bw() + theme(axis.text = element_text(colour = "black",size=rel(1)), axis.title = element_text(size=rel(1), face = "bold"), plot.title = element_text(size = rel(2), face = "bold", hjust = 0.5), legend.position = "none") + 
  labs(x= "Position relative\nto bike path", 
       y= NULL)

```

```{r}
# arranging the plots into a single figure
figure_1 <- ggarrange(f1a, f1b, f1c, f1d, f1e)
```

```{r}
# Adding in vertical y axis label
annotate_figure(figure_1, left = text_grob("Proportion of flowers with pigment", color = "black", rot = 90))

```


## Problem 3

a.

```{r}
coyotes <- read.csv(here("data",
                         "sev220_coyotescatsurvey_20150618.csv"),
                    na = c(".", ".'"))
```


```{r}
coyotes_summary <- coyotes %>%
  mutate(Habitat_type = case_when(Habitat_type == "G" ~ "grassland",
                                  Habitat_type == "S" ~ "shrubland"))
```

```{r}
coyotes_median <- coyotes_summary %>% 
  group_by(Habitat_type) %>% 
  summarize(median_l = median(Length, na.rm = TRUE))
```

```{r}
ggplot(data = coyotes_median, aes(x = Habitat_type, 
                                  y = median_l, 
                                  color = Habitat_type, 
                                  shape = Habitat_type)) +
  geom_point(size = 3) +
  geom_jitter(data = coyotes_summary, aes(x = Habitat_type, y = Length),
              alpha = 0.3) +
  labs(x = "Habitat Type", y = "Median Scat Length", title = "Median length of coyote scat, grassland vs. shrubland") +
  theme_classic() +
  theme(legend.position = "none",
        text = element_text(family = "Times New Roman"))

```

b. 
```{r}
library(naniar)

gg_miss_var(coyotes)
```

c.


## Problem 4

```{r}
icecover <- ntl_icecover
```

```{r}
# ugly plot
plot_1 <- ggplot(data = icecover, aes(x = year, y = ice_duration, color = lakeid)) +
  geom_jitter(na.rm = TRUE, ) +
  labs(title = "Plot 1")
  theme_bw() +
  theme(axis.text.y = element_text(colour = "black",size = 1),
        axis.title.x = element_text(colour = "black",size =  1),
        plot.background = element_blank())
                                   
    
  
 #  axis.title.x = "year",
    #    axis.title.y = "ice duration",
    #    plot.title = "graph 1",
     #   plot.title.position = 0.5,
     #   color = "black",
      

plot_1

```

b.
```{r}
# pretty plot
ggplot(data = icecover, aes(x = year, y = ice_duration, color = lakeid)) +
  geom_jitter(na.rm = TRUE) +
  theme_minimal() +
  scale_color_manual(values = natparks.pals("LakeNakuru", 2)) +
  labs(y = "Ice duration (days)", x = "Year",
       title = "Days of Ice Cover at Lake Mendota and Lake Monona, 1851 - 2019") +
  theme(legend.title = element_blank(),
        axis.title.x = element_text(colour = "black", size = 9),
        axis.title.y = element_text(colour = "black", size = 9),
        plot.title = element_text(size =  10))


```

